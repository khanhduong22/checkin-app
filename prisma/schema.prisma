generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model User {
  id                String              @id @default(cuid())
  name              String?
  email             String?             @unique
  emailVerified     DateTime?
  image             String?
  role              UserRole            @default(USER)
  hourlyRate        Float               @default(0)
  employmentType    EmploymentType      @default(PART_TIME)
  monthlySalary     Float               @default(6000000)
  accounts          Account[]
  checkins          CheckIn[]
  luckyWheelHistory LuckyWheelHistory[]
  adjustments       PayrollAdjustment[]
  requests          Request[]
  sessions          Session[]
  stickyNotes       StickyNote[]
  achievements      UserAchievement[]
  shifts            WorkShift[]
  tasks             UserTask[]
}

model WorkShift {
  id            Int      @id @default(autoincrement())
  userId        String
  start         DateTime
  end           DateTime
  shiftType     String?
  status        String   @default("APPROVED")
  isOpenForSwap Boolean  @default(false)
  createdAt     DateTime @default(now())
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, start])
}

model Request {
  id        Int      @id @default(autoincrement())
  userId    String
  type      String
  date      DateTime
  reason    String
  status    String   @default("PENDING")
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Announcement {
  id        String   @id @default(cuid())
  title     String
  content   String
  type      String   @default("INFO")
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
}

model StickyNote {
  id        String   @id @default(cuid())
  content   String
  color     String   @default("yellow")
  userId    String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model PayrollAdjustment {
  id        String   @id @default(cuid())
  userId    String
  amount    Int
  reason    String
  date      DateTime @default(now())
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model LuckyWheelPrize {
  id          String              @id @default(cuid())
  name        String
  description String?
  image       String?
  quantity    Int                 @default(0)
  remaining   Int                 @default(0)
  probability Float               @default(0)
  type        String              @default("PHYSICAL")
  active      Boolean             @default(true)
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  value       Float               @default(0)
  history     LuckyWheelHistory[]
}

model LuckyWheelHistory {
  id        String           @id @default(cuid())
  userId    String
  prizeId   String?
  prizeName String
  createdAt DateTime         @default(now())
  prize     LuckyWheelPrize? @relation(fields: [prizeId], references: [id])
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UserAchievement {
  id          String   @id @default(cuid())
  userId      String
  code        String
  title       String?
  description String?
  icon        String?
  unlockedAt  DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, code])
}

model ShopPet {
  id        String   @id @default("shop_pet")
  name      String   @default("Mèo Họa Sĩ")
  level     Int      @default(1)
  exp       Int      @default(0)
  health    Int      @default(100)
  mood      Int      @default(100)
  updatedAt DateTime @updatedAt
}

model CheckIn {
  id        Int      @id @default(autoincrement())
  userId    String
  type      String
  timestamp DateTime @default(now())
  ipAddress String
  note      String?
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model AllowedIP {
  id        Int      @id @default(autoincrement())
  prefix    String   @unique
  label     String?
  createdAt DateTime @default(now())
}

model Holiday {
  id          String   @id @default(cuid())
  date        DateTime @unique
  name        String
  multiplier  Float    @default(1.0)
  createdAt   DateTime @default(now())
}

enum UserRole {
  USER
  ADMIN
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
}

enum TaskStatus {
  PENDING
  SUBMITTED
  APPROVED
  REJECTED
}

model TaskDefinition {
  id          String     @id @default(cuid())
  name        String
  description String?
  baseReward  Float      @default(0)
  unit        String
  active      Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  tasks       UserTask[]
}

model UserTask {
  id             String         @id @default(cuid())
  userId         String
  taskDefId      String
  unitPrice      Float
  status         TaskStatus     @default(PENDING)
  quantity       Int            @default(1)
  evidenceLink   String?
  note           String?
  startedAt      DateTime       @default(now())
  submittedAt    DateTime?
  reviewedAt     DateTime?
  reviewedBy     String?
  finalAmount    Float?
  adminNote      String?
  bonusPenalty   Float          @default(0)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  user           User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  taskDefinition TaskDefinition @relation(fields: [taskDefId], references: [id])
}
